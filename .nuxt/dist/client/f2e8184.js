(window.webpackJsonp=window.webpackJsonp||[]).push([[8,9],{382:function(t,e,r){var content=r(396);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(35).default)("4301903a",content,!0,{sourceMap:!1})},385:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return c}));var n=r(19),h=r(32),o=(r(40),r(5),r(15),r(394)),l=r(66),c=function(){function t(e){var r=this;Object(n.a)(this,t),this.floorSize={width:800,height:500,groundHeight:50,wallWidth:100,color:"#000000"},this.humanSize={height:100},this.goalSize={width:90,height:100},this.enviroment={density:5e-4,frictionAir:.02,restitution:.8,friction:.1},this.haveShape={x:1100,y:300},this.startShape="",this.goalShape="",this.Engine=o.Engine,this.Render=o.Render,this.World=o.World,this.Constraint=o.Constraint,this.Body=o.Body,this.Bodies=o.Bodies,this.engine=this.Engine.create(),this.render=this.Render.create({element:e.body,engine:this.engine,options:{width:1400,height:600,wireframes:!1,background:"rgba(255, 255, 255, 0.5)"}}),this.engine.world.gravity.y=.98,this.shapes=[],this.props=e,o.Events.on(this.engine,"collisionStart",(function(t){r.goalCheck(t)})),this.init()}return Object(h.a)(t,[{key:"init",value:function(){this.ground(),this.Engine.run(this.engine),this.Render.run(this.render)}},{key:"hasShape",value:function(t){var e;"circle"===t.name?e=this.circle({x:this.haveShape.x,y:this.haveShape.y,width:t.width}):"rectangle"===t.name?e=this.rectangle({x:this.haveShape.x,y:this.haveShape.y,width:t.width,height:t.height}):"trapezoid"===t.name&&(e=this.trapezoid({x:this.haveShape.x,y:this.haveShape.y,width:t.width,height:t.height,slope:t.slope}));var r=this.Body.create({parts:[e],isStatic:!0});this.World.add(this.engine.world,r)}},{key:"ground",value:function(){var t=this.Body.create({parts:[this.Bodies.rectangle(this.floorSize.width/2,this.floorSize.height-this.floorSize.groundHeight/2,this.floorSize.width-2*this.floorSize.wallWidth,this.floorSize.groundHeight,{render:{fillStyle:this.floorSize.color}}),this.Bodies.rectangle(this.floorSize.wallWidth/2,(this.floorSize.height+this.humanSize.height)/2,this.floorSize.wallWidth,this.floorSize.height-this.humanSize.height,{render:{fillStyle:this.floorSize.color}}),this.Bodies.rectangle(this.floorSize.width-this.floorSize.wallWidth/2,(this.floorSize.height+this.humanSize.height)/2,this.floorSize.wallWidth,this.floorSize.height-this.humanSize.height,{render:{fillStyle:this.floorSize.color}})],isStatic:!0});this.World.add(this.engine.world,t)}},{key:"goal",value:function(){var t=this.Bodies.rectangle(this.floorSize.width-this.floorSize.wallWidth/2,this.humanSize.height/2,this.goalSize.width,this.goalSize.height,{render:{sprite:{texture:"/images/20735.jpg"}}});this.goalShape=t,this.World.add(this.engine.world,[t])}},{key:"circle",value:function(t){var e=this.Bodies.circle(t.x,t.y,t.width/2,this.enviroment);return this.shapes.push(e),this.World.add(this.engine.world,[e]),e}},{key:"rectangle",value:function(t){var rect=this.Bodies.rectangle(t.x,t.y,t.width,t.height,this.enviroment);return this.shapes.push(rect),this.World.add(this.engine.world,[rect]),rect}},{key:"trapezoid",value:function(t){var e=this.Bodies.trapezoid(t.x,t.y,t.width,t.height,t.slope,this.enviroment);return this.shapes.push(e),this.World.add(this.engine.world,[e]),e}},{key:"polygon",value:function(t){var e=this.Bodies.polygon(t.x,t.y,t.sides,t.width,this.enviroment);return this.shapes.push(e),this.World.add(this.engine.world,[e]),e}},{key:"makeShape",value:function(t){var e={x:0,y:this.humanSize.height/2};if(!(t.x>this.floorSize.width)){t.x<this.floorSize.wallWidth+t.width/2?e.x=this.floorSize.wallWidth+t.width/2:t.x>this.floorSize.width-this.floorSize.wallWidth-t.width/2?e.x=this.floorSize.width-this.floorSize.wallWidth-t.width/2:e.x=t.x;var r=t;r.x=e.x,r.y=e.y,"trapezoid"===t.name?this.trapezoid(r):"circle"===t.name?this.circle(r):"rectangle"===t.name&&this.rectangle(r)}}},{key:"readyShape",value:function(){var t={x:this.floorSize.wallWidth/2,y:0,width:60};this.startShape=this.circle(t),this.goal()}},{key:"start",value:function(){this.Body.applyForce(this.startShape,{x:this.startShape.position.x,y:this.startShape.position.y},{x:.2,y:0})}},{key:"reset",value:function(){this.Body.setVelocity(this.startShape,{x:0,y:0}),this.Body.setPosition(this.startShape,{x:this.floorSize.wallWidth/2,y:0})}},{key:"goalCheck",value:function(t){var e=this,r=t.pairs;r.length>0&&r.forEach((function(p){p.bodyA===e.startShape&&p.bodyB===e.goalShape&&(alert("ゴール！！"),l.UsersStore.fetchGoalAt(new Date),l.UsersStore.incrementGoal(),o.Events.off(e.engine,"collisionStart"))}))}},{key:"makeShapeStateRandom",value:function(t){var e=0,r=new Date,n={name:"",width:0,height:0,slope:0};e=t+r.getFullYear()+(r.getMonth()+1)+r.getDate(),e=Math.sin(e);var h=Math.round(100*(e+1))%3;return n.name=0===h?"circle":1===h?"trapezoid":"rectangle",e=t+r.getFullYear()+(r.getMonth()+1)+r.getDate()*r.getDate(),e=Math.sin(e),n.width=Math.round(150+100*e),e=t+r.getFullYear()+(r.getMonth()+1)*(r.getMonth()+1)+r.getDate(),e=Math.sin(e),n.height=Math.round(150+100*e),e=t+r.getFullYear()*r.getFullYear()+(r.getMonth()+1)+r.getDate(),e=Math.sin(e),n.slope=1+e,n}}]),t}()},393:function(t,e,r){r(188)("asyncIterator")},395:function(t,e,r){"use strict";r(382)},396:function(t,e,r){var n=r(34)(!1);n.push([t.i,".canvas{height:550px}.haveShape{position:absolute;font-size:24px;top:250px;left:960px;text-align:center}.shapePostion{height:140px;width:200px}.blind{position:absolute;background-color:rgba(0,0,0,.3);height:500px;width:800px}",""]),t.exports=n},397:function(t,e,r){"use strict";r.r(e);var n=r(22),h=(r(82),r(10),r(64),r(5),r(393),r(73),r(54),r(55),r(74),r(187)),o=r.n(h),l=r(385),c=r(66);function d(t){var e,r,n,h=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);h--;){if(r&&null!=(e=t[r]))return e.call(t);if(n&&null!=(e=t[n]))return new f(e.call(t));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function f(s){function t(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return f=function(s){this.s=s,this.n=s.next},f.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new f(s)}var S={name:"Matter",data:function(){return{MatterJS:0,getShapeState:{x:0,y:0,name:"",width:0,height:0,slope:0},put:!1,randomMathTest:0,fallShape:0,str:!1}},computed:{userid:function(){return c.UsersStore.getUsers.id},putable:function(){return c.UsersStore.getUsers.put_at?this.dayDiff(c.UsersStore.getUsers.put_at):null===c.UsersStore.getUsers.put_at},goalIs:function(){return!!c.UsersStore.getUsers.goal_at&&this.dayDiff(c.UsersStore.getUsers.goal_at)},goalNumber:function(){return c.UsersStore.getUsers.goal}},mounted:function(){this.MatterJS||(this.MatterJS=new l.default({body:this.$refs.matterCanvas}),this.MatterJS.readyShape(),0!==this.userid&&(this.getShapeState=this.MatterJS.makeShapeStateRandom(this.userid),this.MatterJS.hasShape(this.getShapeState)),this.fetchShapes())},methods:{makeShape:function(t){this.getShapeState.x=t.offsetX,this.getShapeState.y=t.offsetY,this.MatterJS&&(this.MatterJS.makeShape(this.getShapeState),this.putatUpdate())},start:function(){this.MatterJS&&this.MatterJS.start(),this.str=!0},reset:function(){this.MatterJS&&this.MatterJS.reset(),this.str=!1},putChange:function(){this.put=!this.put},putatUpdate:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,h,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={id:t.userid,put_at:new Date},n={user_id:t.userid,put_x:t.getShapeState.x},e.prev=2,e.next=5,o.a.put("".concat("http://localhost:7000","/"),r,{withCredentials:!0,headers:{"Content-Type":"application/json"}});case 5:return e.next=7,o.a.post("".concat("http://localhost:7000","/shapes"),n,{withCredentials:!0,headers:{"Content-Type":"application/json"}});case 7:h=e.sent,data=h.data,c.ShapesStore.fetch(data),c.UsersStore.fetchPutAt(new Date),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[2,13]])})))()},fetchShapes:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,data,h,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.a.get("".concat("http://localhost:7000","/shapes"),{withCredentials:!0,headers:{"Content-Type":"application/json"}});case 3:r=e.sent,data=r.data,t.fallShape=data.length,c.ShapesStore.fetch(data),h=function(e){return new Promise((function(r){var data=e;window.setTimeout((function(){var e=t.MatterJS.makeShapeStateRandom(data.user_id);e.x=data.put_x,e.y=0,t.MatterJS.makeShape(e),t.fallShape=t.fallShape-1,r("ok")}),2e3)}))},l=function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(){var e,r,n,o,l,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=!1,r=!1,t.prev=2,o=d(data);case 4:return t.next=6,o.next();case 6:if(!(e=!(l=t.sent).done)){t.next=13;break}return c=l.value,t.next=10,h(c);case 10:e=!1,t.next=4;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(2),r=!0,n=t.t0;case 19:if(t.prev=19,t.prev=20,!e||null==o.return){t.next=24;break}return t.next=24,o.return();case 24:if(t.prev=24,!r){t.next=27;break}throw n;case 27:return t.finish(24);case 28:return t.finish(19);case 29:case"end":return t.stop()}}),t,null,[[2,15,19,29],[20,,24,28]])})));return function(){return t.apply(this,arguments)}}(),l(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))()},dayDiff:function(t){var e=new Date,r=new Date(t),n=e.getDate()-r.getDate(),h=e.getMonth()-r.getMonth(),o=e.getFullYear()-r.getFullYear();return 0!==n||0!==h||0!==o}}},v=S,w=(r(395),r(48)),y=r(124),x=r.n(y),m=r(378),component=Object(w.a)(v,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"canvas"},[0===t.userid?r("span",[r("v-btn",{attrs:{text:"",disabled:""}},[t._v("ログインしてください")])],1):t.goalIs?r("span",[r("v-btn",{attrs:{text:"",disabled:t.str},on:{click:t.start}},[t._v("start")]),t._v(" "),r("v-btn",{attrs:{text:""},on:{click:t.reset}},[t._v("reset")])],1):t.goalIs?t._e():r("span",[r("v-btn",{attrs:{text:"",disabled:""}},[t._v("今日はゴールできました")])],1),t._v(" "),r("span",[t._v("あと"+t._s(t.fallShape)+"個落ちてきます")]),t._v(" "),r("span",[t._v("ゴールした回数 "+t._s(t.goalNumber)+"回")]),t._v(" "),t.put&&0!==t.userid&&t.putable?t._e():r("div",{staticClass:"blind"}),t._v(" "),r("div",{ref:"matterCanvas",on:{click:t.makeShape}}),t._v(" "),0!==t.userid?r("div",{staticClass:"haveShape"},[r("p",[t._v("あなたが今日置ける図形")]),t._v(" "),r("div",{staticClass:"shapePostion"}),t._v(" "),t.putable?t.put?t.put?r("v-btn",{attrs:{text:""},on:{click:t.putChange}},[t._v("置かない")]):t._e():r("v-btn",{attrs:{text:""},on:{click:t.putChange}},[t._v("置く")]):r("v-btn",{attrs:{text:"",disabled:""}},[t._v("今日はもう置けません")])],1):t._e()])}),[],!1,null,null,null);e.default=component.exports;x()(component,{VBtn:m.a})}}]);