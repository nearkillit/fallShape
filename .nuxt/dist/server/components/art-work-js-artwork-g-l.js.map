{"version":3,"file":"components/art-work-js-artwork-g-l.js","sources":["webpack:///./components/ArtWork/js/ArtworkGL.js"],"sourcesContent":["import * as THREE from 'three'\nimport * as CANNON from 'cannon'\n// import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls'\n\nexport default class ArtworkGL {\n  constructor(props) {\n    this.state = {}\n    this.addbox = []\n    this.lastTime = ''\n    this.fixedTimeStep = 1.0 / 60.0 // seconds\n    this.maxSubSteps = 10\n    this.CONSTANT = {\n      initPoint: { x: 0, y: 0, z: 0 },\n      initWeight: 5,\n      initMass: 5,\n      positionY: 20,\n      margin: 20,\n      rotate: {\n        x: 0,\n        y: 0,\n        z: 0,\n      },\n\n      ground_size: 100,\n      axis_rotate: 0,\n      limit: 2,\n      width: 100,\n      height: 100,\n      color1: '#cccccc',\n    }\n\n    this.world = new CANNON.World()\n    this.scene = new THREE.Scene()\n    this.camera = new THREE.PerspectiveCamera(\n      80,\n      window.innerWidth / window.innerHeight\n    )\n\n    this.renderer = new THREE.WebGLRenderer({\n      canvas: props.$canvas,\n    })\n    // this.renderer = new THREE.WebGLRenderer()\n\n    this.props = props\n    this.init()\n  }\n\n  init() {\n    // init World\n    this.world.gravity.set(0, -9.82, 0) // m/s²\n\n    this.camera.position.set(0, 0, 100)\n    // generate object\n    this.generate()\n    // light\n    // 環境光源\n    const ambient = new THREE.AmbientLight(0xffffff, 1)\n    this.scene.add(ambient)\n    // 平行光源\n    const direction = new THREE.DirectionalLight(0xffffff, 1)\n    this.scene.add(direction)\n    // // 点光源\n    // const pointLight = new THREE.PointLight(0xffffff, 10, 100, 1.0)\n    // pointLight.position.set(7, 0, 0)\n    // this.scene.add(pointLight)\n    // // 照明を可視化するヘルパー\n    // const lightHelper = new THREE.PointLightHelper(pointLight)\n    // this.scene.add(lightHelper)\n    // controls ------------------------------\n    // const controls = new OrbitControls(this.camera, this.props.$canvas)\n    // controls.maxDistance = 5000.0\n    // renderer\n    // const renderer = new THREE.WebGLRenderer()\n    this.renderer.setSize(window.innerWidth, window.innerHeight)\n    // add helper\n    // const gridHelper = new THREE.GridHelper(1000, 20) // size, step\n    // this.scene.add(gridHelper)\n    // const axisHelper = new THREE.AxisHelper(1000, 50)\n    // this.scene.add(axisHelper)\n    // X軸が赤色、Y軸が緑色、Z軸が青色\n\n    this.render()\n    requestAnimationFrame(() => this.animate(0))\n  }\n\n  Ground(size) {\n    // cannon body ----------\n    const body = new CANNON.Body({\n      mass: 0, // mass == 0 makes the body static\n    })\n    body.addShape(new CANNON.Plane())\n    // cannonではz軸を上向きの軸としてるので、床を設置するとxy面に床が生成される\n    // three.jsだとy軸を上向き軸としがちなので、変な感じにならないようにx軸に90度回転させてあげる。\n    body.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2)\n    // three mesh ----------\n    const geometry = new THREE.PlaneGeometry(size, size)\n    const material = new THREE.MeshBasicMaterial({\n      color: this.CONSTANT.color1,\n      side: THREE.DoubleSide,\n    })\n\n    const mesh = new THREE.Mesh(geometry, material)\n    mesh.rotation.x = -Math.PI / 2\n    mesh.position.y = 0\n\n    return { body, mesh }\n  }\n\n  /**\n   * 箱作る\n   * @return {body, mesh} ThreejsのmeshとCannon.jsのbodyを返す\n   */\n  Box(props) {\n    const { point, weight, mass } = props\n    // cannon body ----------\n    const body = new CANNON.Body({\n      mass, // kg\n      position: new CANNON.Vec3(point.x, point.y, point.z), // m\n      shape: new CANNON.Box(\n        new CANNON.Vec3(weight / 2, weight / 2, weight / 2)\n      ),\n    })\n\n    // 回転追加してみる\n    // body.angularVelocity.set(Math.random(), Math.random(), 0)\n    // three mesh ----------\n    const geometry = new THREE.BoxGeometry(weight, weight, weight)\n    const material = new THREE.MeshStandardMaterial({\n      color: 0xaa0000,\n      roughness: 0.0,\n    })\n\n    const mesh = new THREE.Mesh(geometry, material)\n    mesh.position.set(point.x, point.y, point.z)\n    return { body, mesh }\n  }\n\n  generate() {\n    // 床\n    const ground = this.Ground(this.CONSTANT.ground_size)\n    this.scene.add(ground.mesh)\n    this.world.addBody(ground.body)\n    const boxPosition = { x: 0, y: this.CONSTANT.positionY, z: 0 }\n    const box = (this.state.box = this.Box({\n      point: boxPosition,\n      weight: this.CONSTANT.initWeight,\n      mass: this.CONSTANT.initMass,\n    }))\n\n    this.scene.add(box.mesh)\n    this.world.addBody(box.body)\n  }\n\n  animate(time) {\n    const { box } = this.state\n    if (this.lastTime !== undefined) {\n      const dt = (time - this.lastTime) / 1000\n      this.world.step(this.fixedTimeStep, dt, this.maxSubSteps)\n    }\n    const { mesh, body } = box\n    // Cannno.js の Three.js へのつなぎこみは\n    // copy で body の position, quaternion を mesh に反映させるだけ！\n    mesh.position.copy(body.position)\n    mesh.quaternion.copy(body.quaternion)\n    // makebox\n    this.addbox.map((ab) => {\n      ab.mesh.position.copy(ab.body.position)\n      ab.mesh.quaternion.copy(ab.body.quaternion)\n      return ab\n    })\n    this.lastTime = time\n    this.render()\n    // this.camera.lookAt(new THREE.Vector3(200, 0, 100))\n    requestAnimationFrame(() => this.animate(0))\n  }\n\n  render() {\n    this.renderer.render(this.scene, this.camera)\n  }\n\n  // add methods\n  makeBox(getPostion) {\n    const mouse = new THREE.Vector2()\n    mouse.x = (getPostion.x / window.innerWidth) * 2 - 1\n    mouse.y = -(getPostion.y / window.innerHeight) * 2 + 1\n    mouse.y = mouse.y < 0 ? 0.1 : mouse.y\n\n    const boxPosition = {\n      x: mouse.x * this.CONSTANT.ground_size,\n      y: mouse.y * this.CONSTANT.ground_size,\n      z: 0,\n    }\n    const box = this.Box({\n      point: boxPosition,\n      weight: this.CONSTANT.initWeight,\n      mass: this.CONSTANT.initMass,\n    })\n    this.addbox.push(box)\n\n    this.scene.add(box.mesh)\n    this.world.addBody(box.body)\n  }\n\n  getRandomInt(max) {\n    return Math.floor(Math.random() * max)\n  }\n}\n"],"mappings":";;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AAjBA;AAoBA;AACA;AACA;AAKA;AACA;AADA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAGA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAHA;AASA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAHA;AAKA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1MA;;;;A","sourceRoot":""}